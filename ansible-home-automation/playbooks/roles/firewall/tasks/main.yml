---
- name: Allow Sonos Controller Discovery
  ansible.windows.win_firewall_rule:
    name: "Allow Sonos Discovery"
    direction: in
    action: allow
    protocol: UDP
    localport: 1900
    enable: yes
    group: "Sonos"

- name: Allow Sonos Streaming (1400)
  ansible.windows.win_firewall_rule:
    name: "Allow Sonos Streaming"
    direction: in
    action: allow
    protocol: TCP
    localport: 1400
    enable: yes
    group: "Sonos"


- name: Allow MQTT Communication (1883)
  ansible.windows.win_firewall_rule:
    name: "Allow MQTT"
    direction: in
    action: allow
    protocol: TCP
    localport: 1883
    enable: yes
    group: "IoT"

- name: Allow Zigbee2MQTT Communication (8883)
  ansible.windows.win_firewall_rule:
    name: "Allow Zigbee2MQTT"
    direction: in
    action: allow
    protocol: TCP
    localport: 8883
    enable: yes
    group: "IoT"

- name: Block all incoming traffic except local network (192.168.50.0/24)
  ansible.windows.win_firewall_rule:
    name: "Block External Access"
    direction: in
    action: block
    remoteip: "0.0.0.0-192.168.50.0/24"
    enable: yes
    group: "Security"


- name: Allow all outgoing traffic
  ansible.windows.win_firewall_rule:
    name: "Allow All Outgoing"
    direction: out
    action: allow
    enable: yes
    group: "Security"

- name: Restart Windows Firewall
  ansible.windows.win_service:
    name: "mpssvc"
    state: restarted

